import{_ as V,r as k,c as b,o as I,g as W,j as E,v as Q,a as _,F as X,k as K,l as fe,t as F,m as ge,n as ye,p as he,q as me,e as _e,s as ve,x as we,y as Ie,z as U,A as be,B as Le}from"./YzfS9bww.js";const Se={class:"address-search-wrapper"},Pe=["placeholder"],Ce={key:0,class:"suggestions-list"},Oe=["onMousedown"],ke={key:1,class:"loading-indicator"},De={__name:"AddressSearch",props:{dadataToken:{type:String,required:!0},placeholder:{type:String,default:"Введите адрес"}},emits:["address-selected"],setup(M,{emit:x}){const C=M,v=x,m=k(""),g=k([]),L=k(!1),T=k(!1);let $=null;async function p(){if($&&clearTimeout($),m.value.length<3){g.value=[];return}$=setTimeout(async()=>{await u()},300)}async function u(){if(!m.value||m.value.length<3){g.value=[];return}T.value=!0;try{const c=await fetch("https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Token ${C.dadataToken}`},body:JSON.stringify({query:m.value,count:10})});if(!c.ok){console.error("DaData API error:",c.status),g.value=[];return}const d=await c.json();g.value=(d.suggestions||[]).filter(r=>r.data.geo_lat&&r.data.geo_lon)}catch(c){console.error("DaData search error:",c),g.value=[]}finally{T.value=!1}}function a(c){m.value=c.value,L.value=!1,v("address-selected",{lat:parseFloat(c.data.geo_lat),lng:parseFloat(c.data.geo_lon),label:c.value,data:c})}function D(){setTimeout(()=>{L.value=!1},200)}return(c,d)=>(I(),b("div",Se,[W(_("input",{"onUpdate:modelValue":d[0]||(d[0]=r=>m.value=r),type:"text",placeholder:M.placeholder,class:"address-input",onInput:p,onFocus:d[1]||(d[1]=r=>L.value=!0),onBlur:D},null,40,Pe),[[Q,m.value]]),L.value&&g.value.length>0?(I(),b("div",Ce,[(I(!0),b(X,null,K(g.value,(r,n)=>(I(),b("div",{key:n,class:"suggestion-item",onMousedown:fe(f=>a(r),["prevent"])},F(r.value),41,Oe))),128))])):E("",!0),T.value?(I(),b("div",ke,"Загрузка...")):E("",!0)]))}},Te=V(De,[["__scopeId","data-v-ff555c02"]]),Ee={class:"object-search"},xe={key:1,class:"search-expanded"},$e={class:"search-header"},Me={key:0,class:"search-results"},Ae=["onClick"],Ge={class:"result-title"},Ne={class:"result-meta"},je={class:"result-id"},Re={class:"result-type"},Be={key:1,class:"no-results"},Fe={__name:"ObjectSearch",props:{objects:{type:Array,default:()=>[]}},emits:["object-selected"],setup(M,{emit:x}){const C=M,v=x,m=k(""),g=k(!1),L=k(!1),T=k(null),$=ge(()=>{if(!m.value||m.value.length<2)return[];const c=m.value.toLowerCase();return C.objects.filter(d=>d.searchfield?d.searchfield.toLowerCase().includes(c):!1).slice(0,10)});function p(){g.value=!0}function u(c){v("object-selected",c),m.value="",g.value=!1,L.value=!1}async function a(){L.value=!0,await ye(),T.value&&T.value.focus()}function D(){L.value=!1,m.value="",g.value=!1}return document.addEventListener("click",c=>{c.target.closest(".object-search")||(g.value=!1)}),(c,d)=>(I(),b("div",Ee,[L.value?E("",!0):(I(),b("button",{key:0,class:"search-toggle-btn",onClick:a,title:"Поиск объектов"},[...d[2]||(d[2]=[_("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[_("circle",{cx:"11",cy:"11",r:"8"}),_("path",{d:"m21 21-4.35-4.35"})],-1)])])),L.value?(I(),b("div",xe,[_("div",$e,[W(_("input",{ref_key:"searchInput",ref:T,"onUpdate:modelValue":d[0]||(d[0]=r=>m.value=r),type:"text",placeholder:"Поиск объектов (ID или название)...",class:"search-input",onInput:p,onFocus:d[1]||(d[1]=r=>g.value=!0)},null,544),[[Q,m.value]]),_("button",{class:"close-btn",onClick:D,title:"Закрыть"},[...d[3]||(d[3]=[_("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[_("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),_("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),g.value&&$.value.length>0?(I(),b("div",Me,[(I(!0),b(X,null,K($.value,r=>(I(),b("div",{key:r.id,class:"search-result-item",onClick:n=>u(r)},[_("div",Ge,F(r.title),1),_("div",Ne,[_("span",je,"ID: "+F(r.id),1),_("span",Re,F(r.typeLabel),1)])],8,Ae))),128))])):E("",!0),g.value&&m.value&&$.value.length===0?(I(),b("div",Be," Объекты не найдены ")):E("",!0)])):E("",!0)]))}},Ye=Object.assign(V(Fe,[["__scopeId","data-v-c07ac639"]]),{__name:"ObjectSearch"}),ze={class:"reset-view-button"},Ve={__name:"ResetViewButton",emits:["reset-view"],setup(M,{emit:x}){const C=x;function v(){C("reset-view")}return(m,g)=>(I(),b("div",ze,[_("button",{class:"reset-btn",onClick:v,title:"Вернуть исходный вид карты"},[...g[0]||(g[0]=[he('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-a0484528><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" data-v-a0484528></path><path d="M21 3v5h-5" data-v-a0484528></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" data-v-a0484528></path><path d="M3 21v-5h5" data-v-a0484528></path></svg>',1)])])]))}},Je=V(Ve,[["__scopeId","data-v-a0484528"]]),A=()=>{const v=async(r,n=null,f={})=>{try{let y=n?{categoryId:n}:{};y={...y,...f};const S={entityTypeId:139,filter:y};let B=[];for await(const J of r.fetchListMethod("crm.item.list",S,"id","items"))B=B.concat(J);return B}catch(y){return console.error("Ошибка получения геообъектов:",y),[]}};return{SMART_PROCESS_ID:139,POLYGON_TYPE_ID:61,POINT_TYPE_ID:65,getGeoObjects:v,getStages:async(r,n)=>{try{return(await r.callMethod("crm.status.list",{filter:{ENTITY_ID:`DYNAMIC_139_STAGE_${n}`}}))._data?.result||[]}catch(f){return console.error("Ошибка получения стадий:",f),[]}},getPolygons:async r=>await v(r,61,{"!@stageId":["DT139_61:SUCCESS","DT139_61:FAIL"]}),getPoints:async r=>await v(r,65,{"!@stageId":["DT139_65:SUCCESS","DT139_65:FAIL"]}),getPolygonsDone:async r=>await v(r,61,{"@stageId":["DT139_61:SUCCESS","DT139_61:FAIL"]}),getPointsDone:async r=>await v(r,65,{"@stageId":["DT139_65:SUCCESS","DT139_65:FAIL"]}),getItem:async(r,n)=>{try{return(await r.callMethod("crm.item.get",{entityTypeId:139,id:n}))._data?.result?.item||null}catch(f){return console.error("Ошибка получения элемента:",f),null}},createGeoObject:async(r,n,f)=>{try{const y={entityTypeId:139,fields:{categoryId:f,...n}},S=await r.callMethod("crm.item.add",y);return console.log(S._data.result),S._data.result}catch(y){throw console.error("Ошибка создания геообъекта:",y),y}},updateGeoObject:async(r,n,f)=>{try{const y={entityTypeId:139,id:n,fields:f};return(await r.callMethod("crm.item.update",y)).data}catch(y){throw console.error("Ошибка обновления геообъекта:",y),y}},deleteGeoObject:async(r,n)=>{try{const f={entityTypeId:139,id:n};return(await r.callMethod("crm.item.delete",f)).data}catch(f){throw console.error("Ошибка удаления геообъекта:",f),f}},openEntityCard:async(r,n,f)=>{try{await r.callMethod("BX24.openPath",{path:`/crm/type/${n}/details/${f}/`})}catch(y){console.error("Ошибка открытия карточки:",y)}},getAuthData:r=>{if(!r)return null;const n=r.auth.getAuthData();return{domain:n.domain||"",member_id:n.member_id||"",access_token:n.access_token||"",refresh_token:n.refresh_token||"",expires_in:n.expires_in||0}}}},Ue={class:"map-container"},qe={key:0,class:"loading"},Ze={key:1,class:"editing-notification"},H=8,He=me({__name:"amap",setup(M){const x=k(null),C=k(!1),v=k("Инициализация..."),m="bdada324570819ed4d44e19c6b7472b5a03ab27e",g=k([]),L=k(!1),T=[55.80205657605603,37.75009144921874],{$leaflet:$}=_e();let p=null,u=null,a=null,D=null,c=null,d=null,r=null,n=null,f=!1,y=!1,S=null;ve(async()=>{try{v.value="Подключение к Bitrix24...";{console.log("Initializing B24Frame...");const{initializeB24Frame:t,LoggerBrowser:o}=await we(async()=>{const{initializeB24Frame:e,LoggerBrowser:l}=await import("./IaQKLP8L.js");return{initializeB24Frame:e,LoggerBrowser:l}},[],import.meta.url);u=await t(),u.setLogger(o.build("MapWidget")),console.log("B24Frame initialized"),console.log("Placement info:",u.getTargetOrigin()),console.log("Auth data:",u.auth.getAuthData()),v.value="Загрузка карты...",p=$,console.log("L.markerClusterGroup available:",typeof p.markerClusterGroup)}v.value="Настройка карты...",await B(),C.value=!0}catch(t){console.error("Ошибка инициализации:",t),v.value="Ошибка загрузки карты"}});async function B(){if(!x.value||!p)return;a=p.map(x.value,{center:T,zoom:H}),a.on("contextmenu",i=>{p.popup().setLatLng(i.latlng).setContent(`
        <div style="text-align: center;">
          <button onclick="window.createPointAtLocation(${i.latlng.lat}, ${i.latlng.lng})"
                  style="display: block; width: 100%; margin-bottom: 8px; padding: 8px; cursor: pointer;">
            Создать точку
          </button>
          <button onclick="window.createPolygonAtLocation(${i.latlng.lat}, ${i.latlng.lng})"
                  style="display: block; width: 100%; padding: 8px; cursor: pointer;">
            Создать полигон
          </button>
        </div>
      `).openOn(a)});const t=p.tileLayer("https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",{attribution:"&copy; Google",maxZoom:20,pmIgnore:!0}),o=p.tileLayer("https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",{attribution:"&copy; Google",maxZoom:20,pmIgnore:!0}),e=p.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:19,pmIgnore:!0});e.addTo(a),c=p.geoJSON(null,{pmIgnore:!1,style:{color:"#3388ff",weight:2,opacity:.8,fillOpacity:.4},onEachFeature:(i,w)=>{if(i.properties){const h=`
          <div>
            <strong>${i.properties.title||"Без названия"}</strong><br>
            ${i.properties.description||""}<br>
            <small>ID: ${i.properties.id}</small>
          </div>
        `;w.bindPopup(h),N(w)}}}),d=p.geoJSON(null,{pmIgnore:!1,style:{color:"#888888",weight:2,opacity:.5,fillOpacity:.2},onEachFeature:(i,w)=>{if(i.properties){const h=`
          <div>
            <strong>${i.properties.title||"Без названия"}</strong><br>
            ${i.properties.description||""}<br>
            <small>ID: ${i.properties.id}</small>
          </div>
        `;w.bindPopup(h),N(w)}}}),r=p.markerClusterGroup({pmIgnore:!1}),n=p.markerClusterGroup({pmIgnore:!1}),c.addTo(a),r.addTo(a);const l={"Google Street":t,"Google Hybrid":o,OpenStreetMap:e},s={"Полигоны в работе":c,"Обработанные полигоны":d,"Точки в работе":r,"Обработанные точки":n};p.control.layers(l,s).addTo(a),a.on("overlayadd",i=>{i.layer===d&&!f?te():i.layer===n&&!y&&oe()}),a.pm.addControls({position:"bottomleft",drawMarker:!0,drawPolygon:!0,drawPolyline:!1,drawCircle:!1,drawCircleMarker:!1,drawRectangle:!0,editMode:!1,dragMode:!1,cutPolygon:!1,removalMode:!1}),ae(),await J(),await ee()}async function J(){if(!(!u||!c))try{v.value="Загрузка полигонов...";const{getPolygons:t}=A(),o=await t(u);console.log("Загружено полигонов в работе:",o.length),o.forEach(e=>{if(e.ufCrm33_1705393860)try{const l={type:"Feature",properties:{title:e.title,description:e.ufCrm33_1705393848,id:e.id,type:"smart",stageId:e.stageId,searchfield:e.id+"-"+e.title},geometry:JSON.parse(e.ufCrm33_1705393860)};c.addData(l)}catch(l){console.error("Ошибка обработки полигона:",e.id,l)}}),G()}catch(t){console.error("Ошибка загрузки полигонов:",t)}}async function ee(){if(!(!u||!r))try{v.value="Загрузка точек...";const{getPoints:t}=A(),o=await t(u);console.log("Загружено точек в работе:",o.length),o.forEach(e=>{if(e.ufCrm33_1705393860)try{const l=JSON.parse(e.ufCrm33_1705393860);if(l.type==="Point"&&l.coordinates){const[s,i]=l.coordinates,w=`
            <div>
              <strong>${e.title||"Без названия"}</strong><br>
              ${e.ufCrm33_1705393848||""}<br>
              <small>ID: ${e.id}</small>
            </div>
          `,h=p.marker([i,s]);h.bindPopup(w),h.feature={properties:{id:e.id,title:e.title,description:e.ufCrm33_1705393848,type:"smart",stageId:e.stageId,searchfield:e.id+"-"+e.title}},N(h,r),r.addLayer(h)}}catch(l){console.error("Ошибка обработки точки:",e.id,l)}}),G()}catch(t){console.error("Ошибка загрузки точек:",t)}}async function te(){if(!(!u||!d||f)){f=!0;try{console.log("Загрузка обработанных полигонов...");const{getPolygonsDone:t}=A(),o=await t(u);console.log("Загружено обработанных полигонов:",o.length),o.forEach(e=>{if(e.ufCrm33_1705393860)try{const l={type:"Feature",properties:{title:e.title,description:e.ufCrm33_1705393848,id:e.id,type:"smart",stageId:e.stageId,searchfield:e.id+"-"+e.title},geometry:JSON.parse(e.ufCrm33_1705393860)};d.addData(l)}catch(l){console.error("Ошибка обработки обработанного полигона:",e.id,l)}}),G()}catch(t){console.error("Ошибка загрузки обработанных полигонов:",t)}}}async function oe(){if(!(!u||!n||y)){y=!0;try{console.log("Загрузка обработанных точек...");const{getPointsDone:t}=A(),o=await t(u);console.log("Загружено обработанных точек:",o.length),o.forEach(e=>{if(e.ufCrm33_1705393860)try{const l=JSON.parse(e.ufCrm33_1705393860);if(l.type==="Point"&&l.coordinates){const[s,i]=l.coordinates,w=`
            <div>
              <strong>${e.title||"Без названия"}</strong><br>
              ${e.ufCrm33_1705393848||""}<br>
              <small>ID: ${e.id}</small>
            </div>
          `,h=p.marker([i,s],{opacity:.5});h.bindPopup(w),h.feature={properties:{id:e.id,title:e.title,description:e.ufCrm33_1705393848,type:"smart",stageId:e.stageId,searchfield:e.id+"-"+e.title}},N(h,n),n.addLayer(h)}}catch(l){console.error("Ошибка обработки обработанной точки:",e.id,l)}}),G()}catch(t){console.error("Ошибка загрузки обработанных точек:",t)}}}async function re(t){if(!u||!a)return;const o=prompt("Введите название объекта:");if(!o||o.trim()===""){a.removeLayer(t.layer);return}try{const{createGeoObject:e,POLYGON_TYPE_ID:l,POINT_TYPE_ID:s}=A();let i=null,w=null;if(t.shape==="Marker"){const O=t.layer.getLatLng();i={type:"Point",coordinates:[O.lng,O.lat]},w=s}else if(t.shape==="Polygon"||t.shape==="Rectangle"){const R=t.layer.getLatLngs()[0].map(Y=>[Y.lng,Y.lat]);R.push(R[0]),i={type:"Polygon",coordinates:[R]},w=l}else{console.error("Неподдерживаемый тип объекта:",t.shape),a.removeLayer(t.layer);return}a.removeLayer(t.layer),a.pm.disableDraw();const h={title:o.trim(),ufCrm33_1705393860:JSON.stringify(i)},P=await e(u,h,w);if(console.log("Create result:",P),!P||!P.item||!P.item.id){console.error("Не удалось создать объект в Битрикс",P);return}const j=P.item.id;u.slider.openPath(u.slider.getUrl(`/crm/type/139/details/${j}/`)).then(async O=>{console.log("Slider response:",O),!O.isOpenAtNewWindow&&O.isClose&&(console.log("Slider is closed! Adding new object to map"),await Z(j))})}catch(e){console.error("Ошибка при создании объекта:",e)}}function ae(){a.on("pm:create",async t=>{console.log("Создан объект:",t.shape,t.layer),await re(t)}),a.on("pm:remove",async t=>{console.log("Удален объект:",t.layer)})}function ne(t){if(!a||!p)return;D&&a.removeLayer(D);const{lat:o,lng:e,label:l}=t;D=p.marker([o,e]).addTo(a),D.bindPopup(l).openPopup(),a.setView([o,e],16,{animate:!0})}function G(){const t=[];c&&c.eachLayer(o=>{if(o.feature&&o.feature.properties){const e=o.feature.properties;t.push({id:e.id,title:e.title||"Без названия",searchfield:e.searchfield,typeLabel:"Полигон в работе",layer:o,layerGroup:c,type:"polygon"})}}),d&&d.eachLayer(o=>{if(o.feature&&o.feature.properties){const e=o.feature.properties;t.push({id:e.id,title:e.title||"Без названия",searchfield:e.searchfield,typeLabel:"Полигон обработан",layer:o,layerGroup:d,type:"polygon"})}}),r&&r.eachLayer(o=>{if(o.feature&&o.feature.properties){const e=o.feature.properties;t.push({id:e.id,title:e.title||"Без названия",searchfield:e.searchfield,typeLabel:"Точка в работе",layer:o,layerGroup:r,type:"point"})}}),n&&n.eachLayer(o=>{if(o.feature&&o.feature.properties){const e=o.feature.properties;t.push({id:e.id,title:e.title||"Без названия",searchfield:e.searchfield,typeLabel:"Точка обработана",layer:o,layerGroup:n,type:"point"})}}),g.value=t}function se(t){if(!(!a||!t.layer)){if(a.hasLayer(t.layerGroup)||a.addLayer(t.layerGroup),t.type==="polygon"){const o=t.layer.getBounds();a.fitBounds(o,{padding:[50,50]}),t.layer.openPopup()}else if(t.type==="point"){const o=t.layer.getLatLng();a.setView(o,16,{animate:!0}),t.layer.openPopup()}}}function le(){a&&a.setView(T,H,{animate:!0,duration:.5})}function N(t,o){t.on("contextmenu",e=>{if(p.DomEvent.stopPropagation(e),!t.feature||!t.feature.properties)return;const l=t.feature.properties.id,s=S&&S._leaflet_id===t._leaflet_id;let i=`
      <button onclick="window.openObjectInSlider(${l})"
              style="display: block; width: 100%; padding: 8px; margin-bottom: 4px; cursor: pointer; background: #0066cc; color: white; border: none; border-radius: 4px;">
        Открыть
      </button>
    `;s?i+=`
        <button onclick="window.finishEditingGeometry()"
                style="display: block; width: 100%; padding: 8px; cursor: pointer; background: #dc3545; color: white; border: none; border-radius: 4px;">
          Завершить редактирование
        </button>
      `:i+=`
        <button onclick="window.editLayerGeometry('${t._leaflet_id}')"
                style="display: block; width: 100%; padding: 8px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 4px;">
          Редактировать
        </button>
      `,p.popup().setLatLng(e.latlng).setContent(`<div style="text-align: center;">${i}</div>`).openOn(a)})}async function ie(t){if(!(!u||!a)){a.closePopup();try{u.slider.openPath(u.slider.getUrl(`/crm/type/139/details/${t}/`)).then(async o=>{console.log("Slider response:",o),!o.isOpenAtNewWindow&&o.isClose&&(console.log("Slider is closed! Refreshing object on map"),await Z(t))})}catch(o){console.error("Ошибка при работе со слайдером:",o)}}}function ce(t){if(!a)return;if(a.closePopup(),S){console.log("Уже редактируется другой слой");return}const o=[c,d,r,n];let e=null;for(const l of o)if(l&&(l.eachLayer(s=>{if(s._leaflet_id.toString()===t){e=s;return}}),e))break;if(!e){console.error("Слой не найден:",t);return}e.pm&&(S=e,L.value=!0,e.pm.enable({allowSelfIntersection:!1,snappable:!0,snapDistance:20}),console.log("Режим редактирования включен. Кликните правой кнопкой для завершения."))}async function q(){if(!(!S||!a)){a.closePopup();try{await ue(S),S.pm.disable(),console.log("Редактирование завершено и изменения сохранены")}catch(t){console.error("Ошибка при завершении редактирования:",t)}finally{S=null,L.value=!1}}}function de(){q()}async function ue(t){if(!(!u||!t.feature||!t.feature.properties))try{const o=t.feature.properties.id;let e=null;if(t instanceof p.Marker){const i=t.getLatLng();e={type:"Point",coordinates:[i.lng,i.lat]}}else if(t.getLatLngs){const w=t.getLatLngs()[0].map(h=>[h.lng,h.lat]);w.push(w[0]),e={type:"Polygon",coordinates:[w]}}if(!e){console.error("Не удалось получить геометрию слоя");return}const{updateGeoObject:l}=A(),s={ufCrm33_1705393860:JSON.stringify(e)};await l(u,o,s),console.log("Геометрия объекта обновлена:",o),t.feature.geometry=e}catch(o){console.error("Ошибка при обновлении геометрии:",o)}}async function Z(t){console.log("refresh for item :",t);const{getItem:o,POLYGON_TYPE_ID:e,POINT_TYPE_ID:l}=A();try{pe(t);const s=await o(u,t);if(!s){console.error("Объект не найден:",t);return}const i=s.categoryId===e,w=s.categoryId===l;if(!s.ufCrm33_1705393860){console.log("Объект не имеет геометрии"),G();return}const h=s.stageId==="DT139_61:SUCCESS"||s.stageId==="DT139_61:FAIL"||s.stageId==="DT139_65:SUCCESS"||s.stageId==="DT139_65:FAIL";if(i){const P=h?d:c,j={type:"Feature",properties:{title:s.title,description:s.ufCrm33_1705393848,id:s.id,type:"smart",stageId:s.stageId,searchfield:s.id+"-"+s.title},geometry:JSON.parse(s.ufCrm33_1705393860)};P.addData(j),P.eachLayer(O=>{O.feature&&O.feature.properties.id===s.id&&N(O,P)})}else if(w){const P=JSON.parse(s.ufCrm33_1705393860);if(P.type==="Point"&&P.coordinates){const[j,O]=P.coordinates,R=h?n:r,Y=`
          <div>
            <strong>${s.title||"Без названия"}</strong><br>
            ${s.ufCrm33_1705393848||""}<br>
            <small>ID: ${s.id}</small>
          </div>
        `,z=p.marker([O,j],{opacity:h?.5:1});z.bindPopup(Y),z.feature={properties:{id:s.id,title:s.title,description:s.ufCrm33_1705393848,type:"smart",stageId:s.stageId,searchfield:s.id+"-"+s.title}},N(z,R),R.addLayer(z)}}G()}catch(s){console.error("Ошибка обновления объекта на карте:",s)}}function pe(t){[c,d,r,n].forEach(e=>{e&&e.eachLayer&&e.eachLayer(l=>{l.feature&&l.feature.properties.id===t&&e.removeLayer(l)})})}return window.openObjectInSlider=ie,window.editLayerGeometry=ce,window.finishEditingGeometry=q,window.createPointAtLocation=(t,o)=>{console.log("Создать точку в координатах:",t,o),a&&a.closePopup()},window.createPolygonAtLocation=(t,o)=>{console.log("Создать полигон от координат:",t,o),a&&a.closePopup()},Ie(()=>{D&&a&&(a.removeLayer(D),D=null),c&&a&&(a.removeLayer(c),c=null),d&&a&&(a.removeLayer(d),d=null),r&&a&&(r.clearLayers(),a.removeLayer(r),r=null),n&&a&&(n.clearLayers(),a.removeLayer(n),n=null),a&&(a.remove(),a=null),u&&(u.destroy(),u=null)}),(t,o)=>(I(),b("div",Ue,[C.value?E("",!0):(I(),b("div",qe,[o[0]||(o[0]=_("div",{class:"spinner"},null,-1)),_("p",null,F(v.value),1)])),_("div",{id:"map",ref_key:"mapElement",ref:x,style:be({opacity:C.value?1:0})},null,4),L.value?(I(),b("div",Ze,[o[1]||(o[1]=_("span",null,"Режим редактирования",-1)),_("button",{onClick:de,class:"finish-btn"},"Завершить")])):E("",!0),C.value?(I(),U(Te,{key:2,"dadata-token":Le(m),onAddressSelected:ne},null,8,["dadata-token"])):E("",!0),C.value?(I(),U(Ye,{key:3,objects:g.value,onObjectSelected:se},null,8,["objects"])):E("",!0),C.value?(I(),U(Je,{key:4,onResetView:le})):E("",!0)]))}}),Qe=V(He,[["__scopeId","data-v-52c3681e"]]);export{Qe as default};
